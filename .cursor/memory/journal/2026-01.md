# Development Journal

> Rename this file to `YYYY-MM.md` (e.g. `2025-12.md`) once you start logging.
> Keep one file per month.


## 2026-01-02

- [CharacterMenu][Refactor] Extracted Familiars panel into modular `FamiliarsTab`
  - Why: Reduce `Services/CharacterMenuService.cs` size and make Familiars UI code owned by `Services/CharacterMenu/Tabs/FamiliarsTab.cs`
  - Key files:
    - `Services/CharacterMenu/Tabs/FamiliarsTab.cs`
    - `Services/CharacterMenuService.cs`
  - Verification:
    - Docs/tools: `dotnet build -c Release` via `C:\Users\Asus\.dotnet8\dotnet.exe` — PASS
    - Assumptions: In-game Familiars UI parity checklist not run in this environment (should be validated in-game)
  - Regression checks run:
    - Build — PASS

- [CharacterMenu][UI] Implemented Exoform tab as a modular panel (no text-entry UI)
  - Why: Align Exoform UX with the newer panel-based tabs (Familiars/Stat Bonuses) and match the DesignMock card layout (overview + forms + abilities).
  - Key files:
    - `Services/CharacterMenu/Tabs/ExoformTab.cs`
    - `Services/CharacterMenuService.cs`
    - `Services/HUD/Shared/HudData.cs`
  - Changes:
    - Converted Exoform from `BuildEntries()` (text list) to `ICharacterMenuTabWithPanel` UI.
    - Added Overview card with current form, exo prestiges, charge bar, and Taunt-to-Exoform ON/OFF indicator.
    - Added Forms list with locked/unlocked state, selected highlighting, and click-to-select (`.prestige sf ...`).
    - Added Active Form Abilities list with localized ability names + cooldowns.
    - Added Exoform sprite allowlist entries (e.g., Dracula portrait / charge visuals) with safe sprite fallback.
  - Verification:
    - Docs/tools: `dotnet build -c Release` via `C:\Users\Asus\.dotnet8\dotnet.exe` — PASS
    - Assumptions: In-game visual validation still needed (spacing + icon availability).
  - Regression checks run:
    - Build — PASS

- [CharacterMenu][UI] Exoform panel: fixed wrapped hint/note text sizing (avoid clipping)
  - Why: `UIFactory.CreateText` uses a fixed-height `LayoutElement`; wrapped text needs a `ContentSizeFitter` path to expand vertically.
  - Key files:
    - `Services/CharacterMenu/Tabs/ExoformTab.cs`
  - Verification:
    - Docs/tools: `dotnet build -c Release` — PASS

- [DesignMock][UI] Added Exoform tab mock UI (charge meter, taunt toggle, forms, abilities)
  - Why: Exoform is payload-driven (`ExoFormDataToClient`) and deserves a first-class, click-forward UI (no visible command strings).
  - Key files:
    - `Docs/DesignMock/index.html`
  - Changes:
    - Overview card with current form, exo prestiges, stored energy meter, and Taunt-to-Exoform ON/OFF indicator
    - Forms card showing unlocked/locked forms and a “selected” state
    - Abilities card showing ability list with cooldowns (form-specific)
    - Notes card capturing core rules (15s minimum energy, drains during form, max duration scales with prestiges)
  - Verification:
    - Docs/tools: Visual inspection in browser — NOT RUN
    - Assumptions: Ability names/icons are placeholders in the HTML mock; real client resolves names via prefab localization.
  - Regression checks run:
    - Build — PASS (no C# changes)
    - In-game Familiars UI smoke test — NOT RUN

- [CharacterMenu][UI] Removed “Bind Familiar (1-10)” card from Familiars tab
  - Why: Reduce vertical clutter; binding remains available via box list interactions / chat commands
  - Key files:
    - `Services/CharacterMenu/Tabs/FamiliarsTab.cs`
  - Verification:
    - Docs/tools: `dotnet build -c Release` via `C:\Users\Asus\.dotnet8\dotnet.exe` — PASS
    - Assumptions: Visual confirmation done in-game by user
  - Regression checks run:
    - Build — PASS

- [Familiars][UI] Shiny box highlighting + toggle status indicators
  - Why: Improve UX by making shiny familiars visually distinct and showing ON/OFF state for combat/emote toggles
  - Key files:
    - `Services/CharacterMenu/Tabs/FamiliarsTab.cs`
    - `Services/DataService.cs`
  - Verification:
    - Docs/tools: `dotnet build -c Release` via `C:\Users\Asus\.dotnet8\dotnet.exe` — PASS
    - Assumptions: Toggle status is derived from parsing server chat replies (unknown until first reply is seen)
  - Regression checks run:
    - Build — PASS

- [DesignMock][UI] Redesigned Stat Bonuses tab to support Weapon Expertise + Blood Legacies
  - Why: StatBonuses system has two parallel systems (weapon/blood) that need UI representation
  - Key files:
    - `Docs/DesignMock/index.html`
  - Changes:
    - Added tabbed interface to switch between Weapon Expertise and Blood Legacies
    - Added weapon type selector (Sword, Axe, Mace, Spear, Crossbow, GreatSword, Slashers, Pistols, Reaper, Longbow, Whip)
    - Added blood type selector (Warrior, Rogue, Brute, Scholar, Creature, Worker, Draculin, Mutant)
    - Weapon header shows: weapon icon, name, bonuses selected, level, progress bar
    - Blood header shows: blood icon, name, bonuses selected, level, progress bar
    - Weapon stats list: 12 offensive stats (MaxHealth, MovementSpeed, AttackSpeed, Lifeleech variants, Power variants, Crit variants)
    - Blood stats list: 12 defensive/utility stats (Healing, DamageReduction, Resistances, Cooldown Recovery, Minion Damage, etc.)
    - Added CSS styles using game sprites (Act_BG.png, BloodType_Rogue_*.png, Stunlock_Icon_BoneSword01.png, etc.)
    - Added JavaScript for tab/selector switching and row click-to-toggle
  - Verification:
    - Docs/tools: Visual inspection in browser — PASS
    - Assumptions: HTML mock is for design reference; actual C# implementation will follow
  - Regression checks run:
    - Build — PASS (no C# changes)

- [DesignMock][UI] Removed blood/weapon type selector rows from Stat Bonuses mock
  - Why: Simplify the UI; these selectors are likely handled differently or not needed in this view
  - Key files:
    - `Docs/DesignMock/index.html`
  - Changes:
    - Removed Weapon Type Selector row (Sword, Axe, etc.)
    - Removed Blood Type Selector row (Warrior, Rogue, etc.)
    - Removed associated CSS and JavaScript cleanup
  - Verification:
    - Docs/tools: Manual check — PASS
  - Regression checks run:
    - Build — PASS (no C# changes)

- [DesignMock][UI] Reduced header heights and redesigned for compactness
  - Why: The previous headers were too tall (80px), taking up too much vertical space; more compact headers match V Rising's UI style better.
  - Key files:
    - `Docs/DesignMock/index.html`
  - Changes:
    - Reduced main Character header height from 80px to 52px.
    - Reduced Stat Bonuses header height and icon sizes (40px -> 32px).
    - Tightened layout spacing and font sizes for a sleeker look.
  - Verification:
    - Docs/tools: Visual check in mock — PASS
  - Regression checks run:
    - Build — PASS (no C# changes)

- [CharacterMenu][Refactor] Extracted Stat Bonuses panel into modular `StatBonusesTab`
  - Why: Reduce `Services/CharacterMenuService.cs` size and make Stat Bonuses UI owned by `Services/CharacterMenu/Tabs/StatBonusesTab.cs`
  - Key files:
    - `Services/CharacterMenu/Tabs/StatBonusesTab.cs`
    - `Services/CharacterMenuService.cs`
  - Verification:
    - Docs/tools: `dotnet build -c Release` via `C:\Users\Asus\.dotnet8\dotnet.exe` — PASS
    - Assumptions: In-game Stat Bonuses UI parity smoke test not run in this environment (should be validated in-game)
  - Regression checks run:
    - Build — PASS

- [CharacterMenu][UI] Updated Stat Bonuses UI to match DesignMock styling
  - Why: Align in-game Stat Bonuses panel visuals with `Docs/DesignMock/index.html` (compact header + clearer rows)
  - Key files:
    - `Services/CharacterMenu/Tabs/StatBonusesTab.cs`
  - Changes:
    - Compact header (44px min height, 32px icon) + meta row (Bonuses, Level, progress bar, %)
    - Darkened header background tint to match Familiars header styling
    - Stat rows now use boxed background sprite styling + checkmark visuals; selected rows use red tint
    - Fixed stat value formatting for 1-based indices (no off-by-one formatting bugs)
    - No placeholder boxes for missing sprites (hide icon when sprite can't resolve)
  - Verification:
    - Docs/tools: `dotnet build -c Release` via `C:\Users\Asus\.dotnet8\dotnet.exe` — PASS
    - Assumptions: In-game visual check still needed
  - Regression checks run:
    - Build — PASS

- [DesignMock][UI] Darkened header tint across tabs to match in-game headers
  - Why: Keep the HTML mock consistent with the new darker in-game header styling
  - Key files:
    - `Docs/DesignMock/index.html`
  - Changes:
    - Added `--header-tint` and applied it to `.top-header`, `.stat-header`, `.prof-header`, `.familiar-card-header`
  - Verification:
    - Docs/tools: Visual inspection in browser — PASS
  - Regression checks run:
    - Build — PASS (no C# changes)

- [CharacterMenu][Feature] Added Blood Legacies view to Stat Bonuses
  - Why: Stat Bonuses UI should support both Weapon Expertise and Blood Legacies (as in the DesignMock)
  - Key files:
    - `Services/CharacterMenu/Tabs/StatBonusesTab.cs`
    - `Services/HUD/Shared/HudData.cs`
  - Changes:
    - Added an internal mode toggle (Weapon Expertise / Blood Legacies)
    - Blood Legacies list renders all 12 blood stats and marks selected stats from Progress data
    - Values computed using the same formula as HUD (`_bloodStatValues` + prestige + class synergy + level scaling)
    - Clicking a blood stat sends `.bl cst [Blood] [StatIndex]` (falls back to numeric-only if blood type is unknown)
    - Added blood type sprite names to the HUD sprite allowlist (icons will render when present)
  - Verification:
    - Docs/tools: `dotnet build -c Release` via `C:\Users\Asus\.dotnet8\dotnet.exe` — PASS
    - Assumptions: In-game visual check still needed (especially blood type icon availability)
  - Regression checks run:
    - Build — PASS

- [Bloodcraft][Legacies] Made `.bl cst` toggle add/remove (like Weapon Expertise)
  - Why: Allow users to click an already-selected blood stat to unselect it (no full reset required)
  - Key files:
    - `Docs/Bloodcraft/Systems/Legacies/BloodManager.cs`
    - `Docs/Bloodcraft/Commands/BloodCommands.cs`
  - Changes:
    - `BloodManager.ChooseStat(...)` now removes the stat if it is already present; otherwise it adds (up to the configured choice limit)
    - `BloodCommands.ChooseBloodStat` reply now reports **selected** vs **removed**
  - Verification:
    - Docs/tools: `dotnet build -c Release -t:Compile` for `Docs/Bloodcraft/Bloodcraft.csproj` — PASS
      - Note: full `Build` triggers a post-build copy to the server plugins folder which requires elevated permissions
  - Regression checks run:
    - Compile — PASS

- [CharacterMenu][UI] Removed Stat Bonuses bottom hint text
  - Why: Reduce clutter; the UI is self-explanatory
  - Key files:
    - `Services/CharacterMenu/Tabs/StatBonusesTab.cs`
    - `Docs/DesignMock/index.html`
  - Verification:
    - Docs/tools: `dotnet build -c Release` — PASS
  - Regression checks run:
    - Build — PASS

- [DesignMock][UI] Redesigned Familiars mock into 2 internal sections (Familiars / Battle Groups)
  - Why: User wants the full familiars + battle familiars experience inside a single Familiars tab, similar to the Stat Bonuses Weapon/Blood mode tabs.
  - Key files:
    - `Docs/DesignMock/index.html`
  - Changes:
    - Removed the standalone Bloodcraft subtab "Battles" (moved concept into Familiars)
    - Added internal mode tabs inside Familiars: **Familiars** and **Battle Groups**
    - Added missing Familiars features to the mock:
      - Shiny + options panel (`.fam shiny`, `.fam option shiny`, `.fam option vbloodemotes`)
      - Smart bind + reset controls (`.fam sb`, `.fam reset`)
      - Box tools (`.fam ab`, `.fam rb`, `.fam db`, `.fam mb`, `.fam r`)
      - Overflow tools (`.fam of`, `.fam om`)
    - Added Battle Groups section mock UI:
      - Battle groups list/show + active group selection (`.fam bgs`, `.fam bg`, `.fam cbg`)
      - Create/delete battle group (`.fam abg`, `.fam dbg`)
      - Slot assignment (1-3) + challenge/arena controls (`.fam sbg`, `.fam challenge`, `.fam sba`)
  - Verification:
    - Docs/tools: HTML lints — PASS
    - Assumptions: Visual review will be done by opening the mock in a browser.
  - Regression checks run:
    - Build — PASS (no C# changes)

- [DesignMock][UI] Removed command pills/labels from Familiars mock
  - Why: Keep the mock UI clean and “in-world” (no visible chat command strings inside the panel).
  - Key files:
    - `Docs/DesignMock/index.html`
  - Changes:
    - Removed all `.fam …` command text from Familiars and Battle Groups sections (action-row right labels and subheader pills)
    - Cleaned up unused CSS for command pill styling
  - Verification:
    - Docs/tools: HTML lints — PASS
  - Regression checks run:
    - Build — PASS (no C# changes)

- [DesignMock][UI] Familiars mock is now click-only (no typing)
  - Why: In-game typing in character menu is awkward; mock should show selection/button-driven UX.
  - Key files:
    - `Docs/DesignMock/index.html`
  - Changes:
    - Removed all text inputs from Familiars + Battle Groups sections (no placeholders / no typing)
    - Added a Destination Box dropdown (used for move-to-box and overflow transfer flows)
    - Added Auto Name buttons for add/rename box and create group
    - Replaced name/slot entry with click/selection flows:
      - Current box click action toggle (Bind vs Remove)
      - Select overflow row + “Move Selected Overflow → Destination Box”
      - Challenge player via dropdown selection (no typing)
  - Verification:
    - Docs/tools: HTML lints — PASS
  - Regression checks run:
    - Build — PASS (no C# changes)

- [CharacterMenu][Feature] Fully implemented Familiars tab (click-only) with Battle Groups mode + overflow + shiny options
  - Why: Make Familiars + Familiar Battles usable in-game without typing and keep the tab modular (not a monolith).
  - Key files:
    - `Services/CharacterMenu/Tabs/FamiliarsTab.cs`
    - `Services/CharacterMenu/Tabs/FamiliarsTab.Battles.cs`
    - `Services/CharacterMenu/Tabs/FamiliarsTab.Overflow.cs`
    - `Services/CharacterMenu/Tabs/FamiliarsTab.Settings.cs`
    - `Services/DataService.cs`
    - `Patches/ClientChatSystemPatch.cs`
    - `Services/HUD/Shared/HudData.cs`
  - Changes:
    - Added internal mode tabs: **Familiars** / **Battle Groups**
    - Familiars mode:
      - Active Familiar card + unified Quick Actions list
      - Boxes & Storage:
        - Destination box dropdown
        - Auto-name add/rename box, confirm delete active box
        - Move active familiar → destination
        - Toggle current-box row action: Bind vs Remove-to-overflow
      - Overflow:
        - Parsed `.fam of` output into `_familiarOverflowEntries`
        - Select overflow entry + move to destination via `.fam om`
      - Shiny & Options:
        - Toggle shiny familiars + VBlood emotes (ON/OFF indicators via chat reply parsing)
        - Shiny buff buttons for spell schools (`.fam shiny …`)
        - Reset familiar state (confirm) (`.fam reset`)
    - Battle Groups mode (payload-driven via `FamiliarBattleDataToClient`):
      - Active group dropdown + auto-name create + confirm delete
      - Slot display + click to assign active familiar to slots 1–3
      - Queue status + admin arena set actions
    - Updated HUD sprite allowlist to include new icons (battle/shiny headers).
  - Verification:
    - Docs/tools: `dotnet build -c Release` via `C:\Users\Asus\.dotnet8\dotnet.exe` — PASS
    - Assumptions: In-game UX/visual validation still needed (especially dropdown + overflow cadence).
  - Regression checks run:
    - Build — PASS
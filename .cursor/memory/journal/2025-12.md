# Development Journal

## 2025-12-28

- [Refactor][Architecture] Modularized monolithic UI/services into component-based architecture with interfaces and orchestrators.
  - Extracted HUD into `Services/HUD/*` (interfaces, bases, managers, orchestrator, integration, utilities, components).
  - Extracted CharacterMenu into `Services/CharacterMenu/*` (tab interface/base, tabs, orchestrator, integration, shared `UIFactory`).
  - Preserved backwards compatibility by keeping public APIs stable and delegating nested static classes to new managers.
  - Phase 5: extracted ConfigureHUD responsibilities into configurators (`Services/HUD/Configurators/*`).

- [Metrics] Reduced service size significantly.
  - `CanvasService.cs`: 3,604 → 1,385 lines (-62%)
  - `CharacterMenuService.cs`: 3,166 → 2,506 lines (-21%)
  - Total: 6,770 → 3,891 lines (-43%)

- [Build][Compat] Applied Il2Cpp-safe fixes and ensured Release build output.
  - Avoided ambiguous `Object.Destroy()` by qualifying `UnityEngine.Object.Destroy()`.
  - Replaced unsupported `RectOffset(left,right,top,bottom)` with property assignment.
  - Updated utilities/imports and fixed orchestrator/tab wiring to compile cleanly.
  - Archived originals under `Docs/Archive/OldServices/*`.
  - Built Release successfully; produced updated `Eclipse.dll`.

- [Docs] Saved full work log:
  - `Docs/WorkLogs/Eclipse-Modularization-2025-12-28.md`

---

## 2025-12-30

- [UI][Familiars][Design Mock] Added a Familiars subtab mock layout.
  - Implemented in `Docs/DesignMock/index.html`:
    - Active familiar card
    - Quick actions
    - Box management
    - Binding grid
    - Advanced commands
  - Refined styling with layout accents, a lightweight reveal animation, and responsive stacking for narrow screens.

- [UI][Familiars][In-Game] Implemented the Familiars tab UI layout in-game.
  - Implemented in `Services/CharacterMenuService.cs`:
    - Custom panel (active familiar card, action rows, bind grid, advanced actions)
    - Data-driven updates and wired progress/stat display from familiar data
  - Updated tab visibility logic to show the new familiars panel instead of text entries.

---

## 2025-12-31

- [UI][Familiars][Sizing/Styling] Tuned in-game layout to prevent overlap and better match game UI visuals.
  - `Services/CharacterMenuService.cs`:
    - Tighter typography, spacing, and overflow handling
    - Game-sprite backgrounds/dividers to prevent text overlap
    - Darkened header tints and adjusted bind grid spacing/padding
    - Vertical column divider participates in layout so columns respect it

- [UI][Familiars][Layout Iterations] Migrated mock → in-game layout refinements.
  - `Docs/DesignMock/index.html`:
    - Redesigned into a 2x2 grid (Active/Quick/Bind/Box), then iterated into final left/right columns:
      - Left: Active / Bind / Advanced
      - Right: Quick / Box
    - Added a box selector with a familiar list and icon-heavy headers
    - Updated headers/dividers to use `Act_BG` + `Divider_Horizontal`
    - Synced to match in-game changes (divider as real element, removed visible command text, icon fallbacks, 10-slot Current Box list with placeholders)

  - `Services/CharacterMenuService.cs`:
    - Ported final left/right column layout with vertical `ActionSlotDivider`
    - Card-wrapped Quick Actions and flexible Box Management stretch
    - Iconized headers/action rows, command pills, and dropdown-style box selector
    - Placeholder Current Box list hooked to active familiar data
    - Forced Current Box list to always render 10 slots (empty rows disabled)

- [Data][Chat Parsing][Familiars Box] Added client-side parsing + live updates from chat replies.
  - `Services/DataService.cs`: parsing for familiar box/chat replies
  - `Patches/ClientChatSystemPatch.cs`: hooked parsing so box selection and current box contents update live
  - Auto-requested box data on a cooldown when the tab opens

- [Interaction][Binding] Improved binding reliability and usability.
  - Made Current Box familiar rows clickable (bind/summon actions)
  - Fixed ambiguity by switching from name-based behavior to slot-based binding:
    - Use `.fam b #` with delayed unbind→bind routine (avoids collisions like “Skeleton” vs “Skeleton Crossbow”)

- [Assets][Sprites] Eliminated missing sprite placeholders (white boxes).
  - Replaced missing Familiars icon sprite names with manifest-backed options
  - Hid header/action icons when sprites fail to resolve
  - Expanded HUD sprite allowlist so headers/dividers/icons resolve from game assets:
    - `Services/HUD/Shared/HudData.cs`

- [Build] Built Release to produce updated `Eclipse.dll` after major UI/data changes.
